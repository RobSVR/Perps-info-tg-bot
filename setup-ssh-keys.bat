@echo off
chcp 65001 >nul
color 0E
cls

echo.
echo ================================================================
echo   üîë –ù–ê–°–¢–†–û–ô–ö–ê SSH –ö–õ–Æ–ß–ï–ô –î–õ–Ø –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ì–û –í–•–û–î–ê
echo ================================================================
echo.
echo –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç SSH –∫–ª—é—á–∏, —á—Ç–æ–±—ã –Ω–µ –≤–≤–æ–¥–∏—Ç—å –ø–∞—Ä–æ–ª—å –∫–∞–∂–¥—ã–π —Ä–∞–∑.
echo.

REM ==========================================
REM  –ù–ê–°–¢–†–û–ô–ö–ò
REM ==========================================
set SERVER=45.132.19.34
set USER=root

echo üì° –°–µ—Ä–≤–µ—Ä: %USER%@%SERVER%
echo.

REM –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è SSH
where ssh >nul 2>&1
if errorlevel 1 (
    echo [–û–®–ò–ë–ö–ê] SSH –Ω–µ –Ω–∞–π–¥–µ–Ω!
    echo.
    echo –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ OpenSSH Client:
    echo –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Windows -^> –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è -^> –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ -^> OpenSSH Client
    echo.
    pause
    exit /b 1
)

REM –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∫–ª—é—á–∞
if exist "%USERPROFILE%\.ssh\id_ed25519" (
    echo ‚úÖ SSH –∫–ª—é—á —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    echo.
    echo –•–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–ª—é—á? (y/n):
    set /p create_new=
    if /i "%create_new%"=="y" (
        echo.
        echo üîë –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ SSH –∫–ª—é—á–∞...
        ssh-keygen -t ed25519 -f "%USERPROFILE%\.ssh\id_ed25519" -N ""
        echo ‚úÖ –ö–ª—é—á —Å–æ–∑–¥–∞–Ω
    )
) else (
    echo üîë –°–æ–∑–¥–∞–Ω–∏–µ SSH –∫–ª—é—á–∞...
    echo.
    echo –í–ù–ò–ú–ê–ù–ò–ï: –ö–æ–≥–¥–∞ —Å–ø—Ä–æ—Å–∏—Ç passphrase - –ø—Ä–æ—Å—Ç–æ –Ω–∞–∂–º–∏—Ç–µ Enter –¥–≤–∞–∂–¥—ã!
    echo.
    pause
    
    if not exist "%USERPROFILE%\.ssh" mkdir "%USERPROFILE%\.ssh"
    ssh-keygen -t ed25519 -f "%USERPROFILE%\.ssh\id_ed25519" -N ""
    
    if errorlevel 1 (
        echo [–û–®–ò–ë–ö–ê] –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∫–ª—é—á
        pause
        exit /b 1
    )
    
    echo ‚úÖ –ö–ª—é—á —Å–æ–∑–¥–∞–Ω
)

echo.
echo ========================================
echo üìã –ö–û–ü–ò–†–û–í–ê–ù–ò–ï –ö–õ–Æ–ß–ê –ù–ê –°–ï–†–í–ï–†
echo ========================================
echo.
echo –°–µ–π—á–∞—Å –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –í–í–ï–°–¢–ò –ü–ê–†–û–õ–¨ –û–î–ò–ù –†–ê–ó.
echo –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–∞—Ä–æ–ª—å –±–æ–ª—å—à–µ –Ω–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è!
echo.
pause

echo.
echo –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–ª—é—á–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä...
echo.

REM –ü—Ä–æ–±—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ssh-copy-id (–º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ Windows)
where ssh-copy-id >nul 2>&1
if not errorlevel 1 (
    ssh-copy-id %USER%@%SERVER%
) else (
    echo –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥...
    echo.
    
    REM –ß–∏—Ç–∞–µ–º –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
    if exist "%USERPROFILE%\.ssh\id_ed25519.pub" (
        echo –ö–æ–ø–∏—Ä—É–µ–º –∫–ª—é—á –≤—Ä—É—á–Ω—É—é...
        echo.
        type "%USERPROFILE%\.ssh\id_ed25519.pub" > temp_key.txt
        
        REM –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± - –∫–æ–ø–∏—Ä—É–µ–º –∫–ª—é—á –≤—Ä—É—á–Ω—É—é
        echo.
        echo ‚ö†Ô∏è –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–ª—é—á –Ω–∏–∂–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
        echo.
        type "%USERPROFILE%\.ssh\id_ed25519.pub"
        echo.
        echo.
        echo –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã:
        echo   ssh %USER%@%SERVER%
        echo   mkdir -p ~/.ssh
        echo   nano ~/.ssh/authorized_keys
        echo   (–≤—Å—Ç–∞–≤—å—Ç–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª—é—á –≤—ã—à–µ, —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ: Ctrl+O, Enter, Ctrl+X)
        echo   chmod 700 ~/.ssh
        echo   chmod 600 ~/.ssh/authorized_keys
        echo.
        pause
        
        del temp_key.txt 2>nul
    ) else (
        echo [–û–®–ò–ë–ö–ê] –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω!
        pause
        exit /b 1
    )
)

echo.
echo ========================================
echo ‚úÖ –ü–†–û–í–ï–†–ö–ê –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø
echo ========================================
echo.

echo –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –±–µ–∑ –ø–∞—Ä–æ–ª—è...
echo.

REM –ü–æ–ø—Ä–æ–±—É–µ–º –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
ssh -o ConnectTimeout=5 -o BatchMode=yes %USER%@%SERVER% "echo OK" 2>nul

if errorlevel 1 (
    echo ‚ö†Ô∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ.
    echo.
    echo –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –≤—Ä—É—á–Ω—É—é:
    echo   ssh %USER%@%SERVER%
    echo.
    echo –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å–∏—Ç –ø–∞—Ä–æ–ª—å - –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤—Ä—É—á–Ω—É—é:
    echo.
    echo   type "%USERPROFILE%\.ssh\id_ed25519.pub"
    echo.
    echo –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—ã–≤–æ–¥ –∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
    echo   mkdir -p ~/.ssh
    echo   echo "–í–ê–®_–ö–õ–Æ–ß" ^>^> ~/.ssh/authorized_keys
    echo   chmod 700 ~/.ssh
    echo   chmod 600 ~/.ssh/authorized_keys
) else (
    echo ‚úÖ –í—Å—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –ø–∞—Ä–æ–ª—è.
)

echo.
echo ========================================
echo üìù –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –†–£–ß–ù–û–ô –ù–ê–°–¢–†–û–ô–ö–ï
echo ========================================
echo.
echo –ï—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞:
echo.
echo 1. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–ª—é—á–∞:
echo    type "%USERPROFILE%\.ssh\id_ed25519.pub"
echo.
echo 2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É:
echo    ssh %USER%@%SERVER%
echo.
echo 3. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
echo    mkdir -p ~/.ssh
echo    nano ~/.ssh/authorized_keys
echo    (–≤—Å—Ç–∞–≤—å—Ç–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª—é—á, —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ: Ctrl+O, Enter, Ctrl+X)
echo    chmod 700 ~/.ssh
echo    chmod 600 ~/.ssh/authorized_keys
echo.
echo 4. –û—Ç–∫–ª—é—á–∏—Ç–µ—Å—å –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞:
echo    ssh %USER%@%SERVER%
echo.
echo –ï—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–∏–ª–æ—Å—å –±–µ–∑ –ø–∞—Ä–æ–ª—è - –≥–æ—Ç–æ–≤–æ! ‚úÖ
echo.
pause

