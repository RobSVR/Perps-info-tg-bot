# Инструкция по деплою через GitHub

## Шаг 1: Очистка и повторная загрузка на GitHub

1. Откройте файл `reload-github.bat`
2. Запустите его двойным кликом
3. Подтвердите операцию (нажмите `y`)
4. Скрипт автоматически:
   - Удалит все файлы из Git индекса
   - Добавит все файлы заново
   - Создаст коммит
   - Отправит на GitHub с force push

⚠️ **Внимание**: Это удалит всю историю коммитов на GitHub и заменит её одним новым коммитом!

## Шаг 2: Деплой на сервер

### Первоначальная настройка (первый раз)

1. Откройте файл `deploy-from-github.bat`
2. Настройте переменные в начале файла:
   - `SERVER` - IP адрес вашего сервера
   - `USER` - пользователь для SSH (обычно `root`)
3. Запустите: `deploy-from-github.bat setup`

Скрипт автоматически:
- Клонирует репозиторий на сервер в `/opt/Perps-info-tg-bot`
- Установит Python зависимости
- Настроит systemd сервис
- Включит автозапуск бота

### Создание файла .env на сервере

После первого запуска нужно создать файл `.env` на сервере:

```bash
ssh root@ВАШ_IP_АДРЕС
cd /opt/Perps-info-tg-bot
nano .env
```

Содержимое файла `.env`:
```
BOT_TOKEN=ваш_токен_бота
CHANNEL_ID=@your_channel
CHANNEL_ID_NUMERIC=-1001234567890
```

Сохраните файл (Ctrl+O, Enter, Ctrl+X) и запустите бота:

```bash
sudo systemctl start perps-bot
sudo systemctl status perps-bot
```

### Обновление бота (после изменений)

После любых изменений в коде:

1. Загрузите изменения на GitHub через `reload-github.bat`
2. Запустите на локальной машине: `deploy-from-github.bat update`

Скрипт автоматически:
- Обновит код на сервере через `git pull`
- Установит новые зависимости (если есть)
- Перезапустит бота

## Альтернативный способ: Ручной деплой

Если автоматические скрипты не работают, можно выполнить команды вручную:

### На сервере:

```bash
# Перейти в директорию проекта
cd /opt/Perps-info-tg-bot

# Обновить код
git pull origin main

# Установить зависимости
pip3 install -r requirements.txt

# Перезапустить бота
sudo systemctl restart perps-bot

# Проверить статус
sudo systemctl status perps-bot
```

## Полезные команды для управления ботом

```bash
# Статус бота
ssh root@ВАШ_IP "sudo systemctl status perps-bot"

# Просмотр логов (в реальном времени)
ssh root@ВАШ_IP "sudo journalctl -u perps-bot -f"

# Остановка бота
ssh root@ВАШ_IP "sudo systemctl stop perps-bot"

# Запуск бота
ssh root@ВАШ_IP "sudo systemctl start perps-bot"

# Перезапуск бота
ssh root@ВАШ_IP "sudo systemctl restart perps-bot"
```

## Решение проблем

### Ошибка при подключении к GitHub

Убедитесь, что:
- Репозиторий существует на GitHub
- У вас есть права на запись в репозиторий
- Настроена аутентификация (SSH ключи или Personal Access Token)

### Ошибка при SSH подключении к серверу

Проверьте:
- Правильность IP адреса
- Наличие SSH ключей или пароля
- Доступность сервера из сети

### Бот не запускается

Проверьте:
- Существует ли файл `.env` на сервере
- Правильно ли указан токен бота
- Логи: `sudo journalctl -u perps-bot -n 50`

